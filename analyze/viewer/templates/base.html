<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CollectiFor – Viewer</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Prism.js CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet" />

    <!-- Prism.js library -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>

<style>
    h2 {text-align: center;}
    body {
        font-family: sans-serif;
        margin: 20px;
        background: #1b2733;
    }

    .container {
        background: #ffffff;
        padding: 20px;
        border-radius: 4px;
        overflow-x: auto;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        table-layout: auto;
        word-break: break-word;
        margin-top: 10px;
    }

    thead th {
        position: sticky;
        top: 0;
        background: #efefef;
        z-index: 2;
    }

    th, td {
        border: 1px solid #ddd;
        padding: 6px 10px;
        text-align: left;
        vertical-align: top;
        max-width: 250px;
        overflow-wrap: break-word;
    }

    tr:nth-child(even) {
        background: #fafafa;
    }

    td.summary {
        max-width: 300px;
        white-space: normal;
        word-break: break-word;
    }

    td.mono pre {
        max-height: 200px;
        overflow: auto;
        background: #f0f0f0;
        padding: 4px;
        border-radius: 3px;
        font-family: monospace;
        white-space: pre-wrap;
    }

    /* Responsive */
    @media (max-width: 768px) {
        table, thead, tbody, th, td, tr {
            display: block;
        }

        thead tr {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }

        tr {
            margin-bottom: 1em;
            border-bottom: 2px solid #ddd;
        }

        td {
            border: none;
            position: relative;
            padding-left: 50%;
            text-align: left;
        }

        td:before {
            position: absolute;
            top: 6px;
            left: 6px;
            width: 45%;
            white-space: nowrap;
            font-weight: bold;
            content: attr(data-label);
        }

        td.summary, td.mono pre {
            padding-left: 50%;
            max-width: 100%;
        }
    }

details summary h3::before {
    content: "▶";          /* closed state icon */
    display: inline-block;
    margin-right: 0.5rem;
    transition: transform 0.2s ease;
}

/* Rotate 90° when open */
details[open] summary h3::before {
    transform: rotate(90deg);
}


input[type="text"]::placeholder {
    color: #d1d9e0;  /* light gray, visible on dark background */
    opacity: 1;       /* ensure full opacity in all browsers */
}

input[type="text"] {
    background-color: #0d1a26;
    color: #d1d9e0;
    border: 1px solid #3a4a5a;
}


input[type="text"]:focus {
    background-color: #0d1a26;
    color: #00ff00;
    border: 1px solid #00ff00;
    box-shadow: 0 0 5px #00ff00;
    outline: none; /* optional, removes default focus outline */
}


</style>

</head>

<body>
<header class="app-header">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid justify-content-center">
    <!-- Brand -->
    <a class="navbar-brand me-4" href="/">CollectiFOR</a>

    <!-- Hamburger for mobile -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar links + collection selector -->
    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-warning" href="/search">Search</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/commands">Commands</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/files">File Navigator</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/checksums">Checksums</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/network">Network</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/listeners">Listeners</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/findings">Findings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/timeline">Timeline Explorer</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/timeline_chart">Timeline Chart</a>
        </li>
      </ul>

      <!-- Collection selector -->
      <form method="post" action="/change_collection" class="d-flex ms-3">
        <input type="hidden" name="next" value="{{ request.full_path }}">
        <select class="form-select form-select-sm bg-dark text-light border-secondary" name="collection" onchange="this.form.submit()">
          <option value=""
            {% if not session.get("collection_name") %}selected{% endif %}>
            All Collections
          </option>
          {% for c in all_collections %}
            <option value="{{ c }}"
              {% if c == session.get("collection_name") %}selected{% endif %}>
              {{ c }}
            </option>
          {% endfor %}
        </select>
      </form>
    </div>
  </div>
</nav>
</header>

{% if not session.get("collection_name") and all_collections and request.endpoint not in ['index', 'checksum_search', 'finding_detail', 'search', 'commands'] %}
  <!-- Modal overlay forcing collection selection -->
  <div id="collection-modal" style="
        position: fixed;
        top:0; left:0; right:0; bottom:0;
        background: rgba(0,0,0,0.5);
        display:flex; justify-content:center; align-items:center;
        z-index:9999;">
    <div style="background:white; padding:2rem; border-radius:0.5rem; text-align:center;">
      <h2>Please select a collection to continue</h2>
      <form method="post" action="/change_collection">
        <input type="hidden" name="next" value="{{ request.path }}">
        <select name="collection" required class="form-select">
          <option value="" disabled selected>Select collection</option>
          {% for c in all_collections %}
            <option value="{{ c }}">{{ c }}</option>
          {% endfor %}
        </select>
        <br><br>
        <button type="submit" class="btn btn-primary">Continue</button>
      </form>
    </div>
  </div>
{% endif %}

<div class="container-fluid px-4 mt-4">
    {% block content %}{% endblock %}
</div>
