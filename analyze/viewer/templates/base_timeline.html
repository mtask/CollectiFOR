<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CollectiFor â€“ Viewer</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Prism.js CSS for styling -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet" />

    <!-- Prism.js library -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>

    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>



<style>
        h2 {text-align: center;}
        body {
            font-family: sans-serif;
            margin: 20px;
            background: #1b2733;
        }

        .container {
            background: #ffffff;
            padding: 20px;
            border-radius: 4px;
            overflow-x: auto;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            table-layout: auto;
            word-break: break-word;
            margin-top: 10px;
        }

        thead th {
            position: sticky;
            top: 0;
            background: #efefef;
            z-index: 2;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 6px 10px;
            text-align: left;
            vertical-align: top;
            overflow-wrap: break-word;
        }

        tr:nth-child(even) {
            background: #fafafa;
        }

        td.summary {
            max-width: 300px;
            white-space: normal;
            word-break: break-word;
        }

        td.mono pre {
            max-height: 200px;
            overflow: auto;
            background: #f0f0f0;
            padding: 4px;
            border-radius: 3px;
            font-family: monospace;
            white-space: pre-wrap;
        }

        /* Responsive */
        @media (max-width: 768px) {
            table, thead, tbody, th, td, tr {
                display: block;
            }

            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            tr {
                margin-bottom: 1em;
                border-bottom: 2px solid #ddd;
            }

            td {
                border: none;
                position: relative;
                padding-left: 50%;
                text-align: left;
            }

            td:before {
                position: absolute;
                top: 6px;
                left: 6px;
                width: 45%;
                white-space: nowrap;
                font-weight: bold;
                content: attr(data-label);
            }

            td.summary, td.mono pre {
                padding-left: 50%;
                max-width: 100%;
            }
        }

/* Force pre inside dark tables to use correct background/text */
.table-dark td pre,
.table-dark th pre {
    background-color: #1b2733 !important; /* match table background */
    color: #f8f9fa !important;            /* light text */
    margin: 0;
    white-space: pre-wrap;
    word-break: break-word;
    font-family: monospace;
}

/* Optional: slightly highlight output container */
.output-preview {
    background-color: #263043;
    border-radius: 0.25rem;
    padding: 0.25rem;
}

/* Dark page inputs and labels */
#start-time, #end-time, #sql-filter, #sort-order {
    background-color: #0d1a26;
    color: #d1d9e0;
    border: 1px solid #3a4a5a;
}
#start-time:focus, #end-time:focus, #sql-filter:focus, #sort-order:focus {
    background-color: #0d1a26;
    color: #00ff00;
    border: 1px solid #00ff00;
    box-shadow: 0 0 5px #00ff00;
}

/* Labels */
label {
    color: #d1d9e0;
}

/* DataTables dark theme */
table.dataTable, .dataTables_wrapper {
    color: #d1d9e0;
    background-color: #1b2733;
}
table.dataTable thead {
    background-color: #273746;
    color: #d1d9e0;
}
table.dataTable tbody tr {
    background-color: #1b2733;
    color: #d1d9e0;
}
table.dataTable tbody tr:nth-child(odd) {
    background-color: #202c3a;
}

/* Buttons */
.btn, .dropdown-item {
    color: #d1d9e0;
    background-color: #273746;
    border-color: #3a4a5a;
}
.btn-primary {
    background-color: #0d6efd;
    border-color: #0d6efd;
    color: #fff;
}
.btn-outline-success {
    color: #00ff00;
    border-color: #00ff00;
}

/* Modal adjustments */
.modal-content {
    background-color: #1b2733;
    color: #d1d9e0;
}
.modal-header, .modal-body {
    color: #d1d9e0;
}

#event-json,
#event-json * {
    text-shadow: none !important;
}

#event-json {
    background-color: #0d1a26;
    color: #7CFC00;                  /* softer green */
    font-family: Consolas, "Courier New", monospace;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    line-height: 1.4;
    font-size: 0.95rem;
    letter-spacing: 0.5px;
    padding: 0.5rem;
    border-radius: 0.25rem;
}

/* Placeholder text for dark inputs */
#start-time::placeholder,
#end-time::placeholder,
#sql-filter::placeholder {
    color: #d1d9e0;  /* light gray, visible on dark background */
    opacity: 1;       /* ensure full opacity in all browsers */
}


/* Toasts */
.toast {
    background-color: #273746;
    color: #d1d9e0;
    border: 1px solid #3a4a5a;
}

#sql-filter::selection {
    background-color: #00FF00; /* invert selection colors */
    color: #000000;
}

#sql-filter:focus {
    font-family: Consolas, "Courier New", monospace;
    font-size: 0.95rem;
    background-color: #000000;  /* black background */
    color: #00FF00;             /* bright green text */
    caret-color: #00FF00;       /* green cursor */
    border: 1px solid #00FF00;  /* optional border */
    padding: 0.375rem 0.75rem;  /* same as Bootstrap input padding */
    outline: none;            /* remove default focus outline */
    box-shadow: 0 0 5px #00FF00; /* glow effect when focused */
}

td:last-child {
    text-align: center;
    white-space: nowrap;
}

// Try to fix heade row alignment
.dataTables_scrollHead table,
.dataTables_scrollBody table {
    table-layout: fixed;
}


/* Headers should never wrap */
.dataTables_scrollHead th {
    white-space: nowrap;
}

/* Body cells default nowrap */
.dataTables_scrollBody td {
    white-space: nowrap;
}

/* EXCEPT message column */
td.message {
    white-space: nowrap;
}
td.message.expanded {
    white-space: normal;
}



/* Message cell */
td.message {
    max-width: 400px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    cursor: pointer;
    position: relative;
}

td.message .short-msg { display: inline; }
td.message .full-msg { display: none; }

td.message.expanded {
    white-space: normal;
}

td.message.expanded .short-msg { display: none; }
td.message.expanded .full-msg {
    display: block;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
}

/* Copy button */
td.message .copy-btn {
    display: none;
    margin-left: 6px;
    cursor: pointer;
    font-size: 0.9em;
    color: #0d6efd;
}

td.message.expanded .copy-btn {
    display: inline;
}

#copy-event-btn {
    font-size: 0.9em;
}


</style>


</head>

<body>
<header class="app-header">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid justify-content-center">
    <!-- Brand -->
    <a class="navbar-brand me-4" href="/">CollectiFOR</a>

    <!-- Hamburger for mobile -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar links + collection selector -->
    <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-warning" href="/search">Search</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/commands">Commands</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/files">File Navigator</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/checksums">Checksums</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/network">Network</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/listeners">Listeners</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/findings">Findings</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/timeline">Timeline Explorer</a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-warning" href="/timeline_chart">Timeline Chart</a>
        </li>
      </ul>

    <!-- Timeline selector on the right -->
    <form method="post" action="/change_timeline" class="d-flex ms-3">
      <input type="hidden" name="next" value="{{ request.full_path }}">
      <select class="form-select form-select-sm bg-dark text-light border-secondary" name="timeline" onchange="this.form.submit()">
        <option value=""
          {% if not session.get("timeline_name") %}selected{% endif %}>
          All Timelines
        </option>
        {% for t in all_timelines %}
          <option value="{{ t }}"
            {% if t == session.get("timeline_name") %}selected{% endif %}>
            {{ t }}
          </option>
        {% endfor %}
      </select>
    </form>
  </div>
</nav>
</header>

<div class="container-fluid px-4 mt-4">
    {% block content %}{% endblock %}
</div>
