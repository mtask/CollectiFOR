{% extends "base.html" %}

{% block content %}
<h2 class="text-light">Files Navigator</h2>

<!-- Search form -->
<div class="row mb-3 justify-content-center align-items-end">
  <div class="col-md-10">
    <form method="get" class="d-flex gap-2">
      <input
        type="text"
        name="q"
        placeholder="Search files..."
        value="{{ search_query|default('') }}"
        class="form-control"
      >
      <button type="submit" class="btn btn-primary">
        Search
      </button>
    </form>
  </div>
</div>

{% if search_query %}
  <p class="text-light">Showing search results for: <strong>{{ search_query }}</strong></p>
  {% if files %}
    <ul class="list-unstyled">
      {% for f in files %}
        <li class="text-light mb-1">
          {{ f.path }}
          <a href="{{ url_for('view_file', path=f.path) }}" class="text-warning text-decoration-none">View</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-light">No files matched your search.</p>
  {% endif %}
{% else %}
  <!-- Breadcrumbs -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('files') }}" class="text-warning">/</a></li>
      {% if current_dir %}
        {% set parts = current_dir.strip('/').split('/') %}
        {% set path_acc = "" %}
        {% for part in parts %}
          {% set path_acc = path_acc + "/" + part %}
          <li class="breadcrumb-item">
            <a href="{{ url_for('files', dir_path=path_acc.lstrip('/')) }}" class="text-warning">{{ part }}</a>
          </li>
        {% endfor %}
      {% endif %}
    </ol>
  </nav>

  <!-- Directories -->
  <h3 class="text-light">Directories</h3>
  {% if dirs %}
    <ul class="list-unstyled">
      {% for d in dirs %}
        <li class="text-light mb-1">
          <a href="{{ url_for('files', dir_path=d.path.lstrip('/')) }}" class="text-warning text-decoration-none">
            {{ d.path.split('/')[-1] }}/
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-light">No directories in this folder.</p>
  {% endif %}

  <!-- Files -->
  <h3 class="text-light">Files</h3>
  {% if files %}
    <ul class="list-unstyled">
      {% for f in files %}
        <li class="text-light mb-1">
          {{ f.path.split('/')[-1] }}
          <a href="{{ url_for('view_file', path=f.path) }}" class="text-warning text-decoration-none">View</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-light">No files in this folder.</p>
  {% endif %}
{% endif %}

{% endblock %}

