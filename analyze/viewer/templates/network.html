{% extends "base.html" %}
{% block content %}
<h2 class="text-light">Network Search</h2>

<div class="row mb-3 justify-content-center align-items-end">
  <div class="col-md-10">
    <form method="get" class="d-flex gap-2">
      <input
        type="text"
        name="q"
        value="{{ q }}"
        placeholder="IP, port, protocol"
        class="form-control"
      >
      <button type="submit" class="btn btn-primary">
        Search
      </button>
    </form>
  </div>
</div>

{% if q %}

<h3 class="text-light">Flows</h3>
{% if flows %}
<table class="table table-dark table-striped table-hover table-sm">
    <thead class="table-secondary">
        <tr>
            <th>Protocol</th>
            <th>Source</th>
            <th>Destination</th>
            <th>Packets</th>
            <th>First Seen</th>
            <th>Last Seen</th>
        </tr>
    </thead>
    <tbody>
    {% for f in flows %}
        <tr>
            <td class="text-light">{{ f.protocol }}</td>
            <td class="text-light">{{ f.src }}:{{ f.src_port }}</td>
            <td class="text-light">{{ f.dst }}:{{ f.dst_port }}</td>
            <td class="text-light">{{ f.packet_count }}</td>
            <td class="text-light">{{ f.first_seen }}</td>
            <td class="text-light">{{ f.last_seen }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-light">No flows found.</p>
{% endif %}

<h3 class="text-light">Packets</h3>
{% if packets %}
<table class="table table-dark table-striped table-hover table-sm">
    <thead class="table-secondary">
        <tr>
            <th>#</th>
            <th>Time</th>
            <th>Proto</th>
            <th>Src</th>
            <th>Dst</th>
            <th>Raw</th>
        </tr>
    </thead>
    <tbody>
    {% for p in packets %}
        <tr>
            <td class="text-light">{{ p.packet_number }}</td>
            <td class="text-light">{{ p.timestamp }}</td>
            <td class="text-light">{{ p.protocol }}</td>
            <td class="text-light">{{ p.src }}:{{ p.src_port }}</td>
            <td class="text-light">{{ p.dst }}:{{ p.dst_port }}</td>
            <td class="mono text-light">{{ p.raw_content }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p class="text-light">No packets found.</p>
{% endif %}

{% endif %}
{% endblock %}

